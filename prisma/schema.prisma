generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String?
  videos    Video[]
  createdAt DateTime @default(now())
}

model Channel {
  id          String  @id @default("default")
  title       String  @default("My Channel")
  description String?
}

model Section {
  id          String      @id @default(uuid())
  title       String
  description String?
  visibility  Visibility  @default(PUBLIC)
  order       Int         @default(0)
  thumbKey    String?
  videos      Video[]
  accessKeys  AccessKey[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Video {
  id          String      @id @default(uuid())
  title       String?
  status      VideoStatus @default(UPLOADING)
  duration    Int?
  screenKey   String?
  cameraKey   String?
  micKey      String?
  outputKey   String?
  thumbKey    String?
  subtitleKey String?
  views       Int         @default(0)
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  sectionId   String?
  section     Section?    @relation(fields: [sectionId], references: [id], onDelete: SetNull)
  segments    Segment[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

model Segment {
  id      String @id @default(uuid())
  videoId String
  video   Video  @relation(fields: [videoId], references: [id], onDelete: Cascade)
  start   Float
  end     Float
  text    String
}

model AccessKey {
  id          String    @id @default(uuid())
  token       String    @unique @default(uuid())
  sectionId   String
  section     Section   @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  type        KeyType
  label       String?
  fingerprint String?
  activatedAt DateTime?
  createdAt   DateTime  @default(now())
}

model InviteCode {
  id        String    @id @default(uuid())
  code      String    @unique @default(uuid())
  usedBy    String?
  usedAt    DateTime?
  createdAt DateTime  @default(now())
}

enum VideoStatus {
  UPLOADING
  PROCESSING
  READY
  FAILED
}

enum Visibility {
  PUBLIC
  PRIVATE
}

enum KeyType {
  PERMANENT
  SINGLE_USE
}
